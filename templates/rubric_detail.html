{% extends "base.html" %}

{% block content %}
  <div class="card">
    <h2>{{ t('guide') }} {{ rubric.id }}</h2>
    <p>{{ t('assignment') }}: <a href="{{ url_for('assignment_detail', assignment_id=assignment.id) }}">{{ assignment.title }}</a></p>
    <p>{{ t('status') }}: <span class="status {{ rubric.status }}">{{ rubric.status }}</span></p>
    <p>{{ t('model') }}: {{ rubric.llm_model or 'manual' }}</p>
    <p>{{ t('created') }}: {{ rubric.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
    {% if duration_seconds is not none %}
      <p>{{ t('duration_s') }}: {{ "%.2f"|format(duration_seconds) }}</p>
    {% endif %}
    {% if rubric.price_estimate is not none %}
      <p>{{ t('price_estimate') }}: <span class="price-amount" data-usd="{{ "%.6f"|format(rubric.price_estimate) }}">${{ "%.4f"|format(rubric.price_estimate) }}</span></p>
    {% endif %}
    {% if rubric.error_message %}
      <p class="status ERROR">{{ t('error') }}: {{ rubric.error_message }}</p>
    {% endif %}
    {% if rubric.status == 'DRAFT' %}
      <a class="action-link" href="{{ url_for('edit_rubric', rubric_id=rubric.id) }}">{{ t('edit_guide') }}</a>
    {% endif %}
  </div>

  <div class="card">
    <h3>{{ t('guide_text') }}</h3>
    <pre>{{ rubric.rubric_text or 'Not available yet.' }}</pre>
  </div>

  <div class="card">
    <h3>{{ t('reference_solution') }}</h3>
    <pre>{{ rubric.reference_solution_text or 'Not available yet.' }}</pre>
  </div>

  {% if rubric.error_message and rubric.raw_response %}
    <div class="card">
      <h3>{{ t('raw_llm_response') }}</h3>
      <pre>{{ rubric.raw_response }}</pre>
    </div>
  {% endif %}

  <div class="card">
    {% if rubric.status == 'DRAFT' %}
      <form method="post" action="{{ url_for('approve_rubric', rubric_id=rubric.id) }}">
        <button type="submit">{{ t('approve_guide') }}</button>
      </form>
    {% elif rubric.status == 'GENERATING' %}
      <form method="post" action="{{ url_for('cancel_rubric', rubric_id=rubric.id) }}">
        <button type="submit" class="secondary">{{ t('cancel_generation') }}</button>
      </form>
    {% elif rubric.status == 'APPROVED' %}
      <p>{{ t('approved_guide_in_use') }}</p>
    {% else %}
      <p>{{ t('guide_not_ready') }}</p>
    {% endif %}
  </div>
{% endblock %}
