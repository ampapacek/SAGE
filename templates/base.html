<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SAGE</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/sage.png') }}" />
    <style>
      :root {
        --bg: #f5f5f5;
        --card: #ffffff;
        --text: #222222;
        --muted: #666666;
        --border: #dddddd;
        --header-bg: #222222;
        --header-text: #ffffff;
        --link: #1b6ef3;
        --accent: #1b6ef3;
        --secondary: #555555;
        --danger: #b00020;
        --flash-bg: #fff6cc;
        --flash-border: #e5d58c;
        --input-bg: #ffffff;
        --pre-bg: #f7f7f7;
        --table-border: #eeeeee;
        --status-draft: #555555;
        --status-approved: #1b6ef3;
        --status-archived: #999999;
        --status-generating: #b36b00;
        --status-error: #c00000;
        --status-cancelled: #777777;
        --status-success: #00aa77;
        --file-bg: #fafafa;
        --file-border: #bbbbbb;
        --file-hover-bg: #f0f6ff;
      }
      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #0f1115;
          --card: #171a21;
          --text: #e6e8ee;
          --muted: #a7adba;
          --border: #2a2f3a;
          --header-bg: #0c2b45;
          --header-text: #e6e8ee;
          --link: #7db1ff;
          --accent: #3b82f6;
          --secondary: #4b5563;
          --danger: #f87171;
          --flash-bg: #2a2412;
          --flash-border: #5b4a16;
          --input-bg: #0f131a;
          --pre-bg: #11161d;
          --table-border: #232833;
          --status-draft: #9ca3af;
          --status-approved: #7db1ff;
          --status-archived: #6b7280;
          --status-generating: #f59e0b;
          --status-error: #f87171;
          --status-cancelled: #9ca3af;
          --status-success: #34d399;
          --file-bg: #0f131a;
          --file-border: #3b4150;
          --file-hover-bg: #0f1a2a;
        }
      }
      html[data-theme="dark"] {
        --bg: #0f1115;
        --card: #171a21;
        --text: #e6e8ee;
        --muted: #a7adba;
        --border: #2a2f3a;
        --header-bg: #0c2b45;
        --header-text: #e6e8ee;
        --link: #7db1ff;
        --accent: #3b82f6;
        --secondary: #4b5563;
        --danger: #f87171;
        --flash-bg: #2a2412;
        --flash-border: #5b4a16;
        --input-bg: #0f131a;
        --pre-bg: #11161d;
        --table-border: #232833;
        --status-draft: #9ca3af;
        --status-approved: #7db1ff;
        --status-archived: #6b7280;
        --status-generating: #f59e0b;
        --status-error: #f87171;
        --status-cancelled: #9ca3af;
        --status-success: #34d399;
        --file-bg: #0f131a;
        --file-border: #3b4150;
        --file-hover-bg: #0f1a2a;
      }
      html[data-theme="light"] {
        --bg: #f5f5f5;
        --card: #ffffff;
        --text: #222222;
        --muted: #666666;
        --border: #dddddd;
        --header-bg: #222222;
        --header-text: #ffffff;
        --link: #1b6ef3;
        --accent: #1b6ef3;
        --secondary: #555555;
        --danger: #b00020;
        --flash-bg: #fff6cc;
        --flash-border: #e5d58c;
        --input-bg: #ffffff;
        --pre-bg: #f7f7f7;
        --table-border: #eeeeee;
        --status-draft: #555555;
        --status-approved: #1b6ef3;
        --status-archived: #999999;
        --status-generating: #b36b00;
        --status-error: #c00000;
        --status-cancelled: #777777;
        --status-success: #00aa77;
        --file-bg: #fafafa;
        --file-border: #bbbbbb;
        --file-hover-bg: #f0f6ff;
      }
      body { font-family: Arial, sans-serif; margin: 0; background: var(--bg); color: var(--text); }
      header { background: var(--header-bg); color: var(--header-text); padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; gap: 12px; }
      header a { color: var(--header-text); text-decoration: none; }
      .logo { display: inline-flex; align-items: center; gap: 10px; }
      .logo img { height: 65px; width: 65px; max-height: 65px; max-width: 65px; object-fit: contain; display: block; }
      .hero-logo { width: 128px; height: 128px; max-width: 128px; max-height: 128px; object-fit: contain; display: block; }
      .home-button { background: var(--accent); padding: 6px 12px; border-radius: 4px; display: inline-block; color: #fff; }
      .back-button { background: #444; padding: 6px 12px; border-radius: 4px; border: none; color: #fff; cursor: pointer; }
      .theme-toggle { background: transparent; border: 1px solid var(--header-text); color: var(--header-text); padding: 6px; border-radius: 4px; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; overflow: hidden; }
      .theme-toggle:hover { background: rgba(255, 255, 255, 0.12); }
      .theme-toggle img { width: 24px; height: 24px; display: block; transform: scale(2.0); transform-origin: center; }
      .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
      .nav-buttons { display: flex; gap: 8px; align-items: center; }
      main { max-width: 1100px; margin: 20px auto; padding: 0 20px 40px; }
      h1, h2, h3 { margin: 0 0 12px; }
      .card { background: var(--card); padding: 16px; border-radius: 6px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
      form label { display: block; font-weight: bold; margin: 10px 0 6px; }
      input[type="text"], textarea, select { display: block; width: 100%; max-width: 1040px; padding: 8px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); border-radius: 4px; box-sizing: border-box; }
      textarea { min-height: 140px; resize: vertical; }
      button { margin-top: 10px; padding: 8px 14px; border: none; background: var(--accent); color: #fff; border-radius: 4px; cursor: pointer; }
      button.secondary { background: var(--secondary); }
      button.danger { background: var(--danger); }
      .file-input { width: 100%; max-width: 1040px; padding: 18px; border: 2px dashed var(--file-border); border-radius: 6px; background: var(--file-bg); color: var(--text); cursor: pointer; box-sizing: border-box; transition: border-color 0.15s ease, background-color 0.15s ease; }
      .file-input:hover { border-color: var(--accent); background: var(--file-hover-bg); }
      .dropzone { margin-bottom: 12px; }
      .dropzone.active .file-input { border-color: var(--accent); background: var(--file-hover-bg); }
      .dropzone-hint { margin-top: 6px; font-size: 12px; color: var(--muted); }
      table { width: 100%; border-collapse: collapse; }
      th, td { text-align: left; padding: 8px; border-bottom: 1px solid var(--table-border); }
      .flash { background: var(--flash-bg); padding: 10px; border: 1px solid var(--flash-border); border-radius: 4px; margin-bottom: 16px; color: var(--text); }
      .status { font-weight: bold; }
      .status.DRAFT { color: var(--status-draft); }
      .status.APPROVED { color: var(--status-approved); }
      .status.ARCHIVED { color: var(--status-archived); }
      .status.GENERATING { color: var(--status-generating); }
      .status.ERROR { color: var(--status-error); }
      .status.CANCELLED { color: var(--status-cancelled); }
      .status.SUCCESS { color: var(--status-success); }
      .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }
      .thumb img { max-width: 100%; height: auto; border: 1px solid var(--border); border-radius: 4px; }
      .hidden { display: none; }
      pre { white-space: pre-wrap; background: var(--pre-bg); padding: 10px; border-radius: 4px; color: var(--text); }
      a { color: var(--link); }
      .markdown { line-height: 1.6; max-width: 1040px; }
      .markdown h1, .markdown h2, .markdown h3, .markdown h4 { margin-top: 18px; }
      .markdown table { width: 100%; border-collapse: collapse; margin: 12px 0; }
      .markdown th, .markdown td { border: 1px solid var(--table-border); padding: 6px 8px; }
    </style>
  </head>
  <body>
    <header>
      <a class="logo" href="{{ url_for('index') }}">
        <img src="{{ url_for('static', filename='images/sage.png') }}" alt="" aria-hidden="true" />
        <span>SAGE</span>
      </a>
      <div class="nav-buttons">
        <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Toggle theme">
          <img id="theme-icon" src="{{ url_for('static', filename='images/sun.png') }}" alt="" aria-hidden="true" />
          <span class="sr-only">Toggle theme</span>
        </button>
        <button class="back-button" type="button" onclick="window.history.length > 1 ? window.history.back() : (window.location.href='{{ url_for('list_assignments') }}')">Back</button>
        <a class="home-button" href="{{ url_for('list_assignments') }}">Home</a>
      </div>
    </header>
    <main>
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          {% for message in messages %}
            <div class="flash">{{ message }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
      {% block content %}{% endblock %}
    </main>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [["$", "$"], ["\\(", "\\)"]],
          displayMath: [["$$", "$$"], ["\\[", "\\]"]]
        },
        options: {
          skipHtmlTags: ["script", "noscript", "style", "textarea", "pre", "code"]
        }
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script>
      (function () {
        var root = document.documentElement;
        var button = document.getElementById("theme-toggle");
        if (!button) {
          return;
        }
        var sunIcon = "{{ url_for('static', filename='images/sun.png') }}";
        var moonIcon = "{{ url_for('static', filename='images/moon.png') }}";
        var iconEl = document.getElementById("theme-icon");
        function applyTheme(theme) {
          if (theme) {
            root.setAttribute("data-theme", theme);
          } else {
            root.removeAttribute("data-theme");
          }
          if (iconEl) {
            iconEl.src = theme === "dark" ? moonIcon : sunIcon;
          }
        }
        var stored = localStorage.getItem("sage-theme");
        if (stored === "light" || stored === "dark") {
          applyTheme(stored);
        } else {
          var prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
          applyTheme(prefersDark ? "dark" : "light");
        }
        button.addEventListener("click", function () {
          var current = root.getAttribute("data-theme");
          var next = current === "dark" ? "light" : "dark";
          applyTheme(next);
          localStorage.setItem("sage-theme", next);
        });
      })();
    </script>
  </body>
</html>
