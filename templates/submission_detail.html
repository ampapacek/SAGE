{% extends "base.html" %}

{% block content %}
  <div class="card">
    <h2>{{ t('submission') }} {{ submission.id }} - {{ submission.student_identifier }}</h2>
    <p>{{ t('assignment') }}: <a href="{{ url_for('assignment_detail', assignment_id=assignment.id) }}">{{ assignment.title }}</a></p>
    <p>{{ t('submitted') }}: {{ submission.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
  </div>

  <div class="card">
    <h3>{{ t('submitted_text') }}</h3>
    {% if student_text %}
      <div class="markdown">{{ student_text_html | safe }}</div>
    {% else %}
      <p>{{ t('no_submitted_text') }}</p>
    {% endif %}
  </div>

  <div class="card">
    <h3>{{ t('files') }}</h3>
    {% if submission.files %}
      <ul>
        {% for file in submission.files %}
          <li><a href="{{ url_for('data_file', filepath=file.file_path) }}">{{ file.original_filename }}</a> ({{ file.file_type }})</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>{{ t('no_files') }}</p>
    {% endif %}
  </div>

  <div class="card">
    <h3>{{ t('images') }}</h3>
    {% if images %}
      <div class="grid">
        {% for path in images %}
          <div class="thumb">
            <img src="{{ url_for('data_file', filepath=path) }}" alt="page" />
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>{{ t('no_images') }}</p>
    {% endif %}
  </div>

  <div class="card">
    <h3>{{ t('grade_result') }}</h3>
    {% if grade_result %}
      {% if grade_result.error_message %}
        <p class="status ERROR">{{ t('error') }}: {{ grade_result.error_message }}</p>
        {% if grade_result.raw_response %}
          <h4>{{ t('raw_llm_response') }}</h4>
          <pre>{{ grade_result.raw_response }}</pre>
        {% endif %}
        <h4>{{ t('raw_json') }}</h4>
        <pre>{{ grade_result.json_result }}</pre>
      {% endif %}
      <pre>{{ grade_result.rendered_text }}</pre>
    {% else %}
      <p>{{ t('no_grade_result') }}</p>
    {% endif %}
  </div>
{% endblock %}
